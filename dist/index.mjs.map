{"mappings":";;;;AAAA;;;;AAcA,SAAS,oCAAc;IACrB,OAAO,OAAO,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE;QAC7B,QAAQ,IAAI,CAAC,MAAM;QACnB,OAAO;YACL,QAAQ,AAAC,CAAA,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,CAAA,EAAG,MAAM;YAC1C,SAAS,AAAC,CAAA,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,CAAA,EAAG,OAAO;QAC9C;QACA,YAAY,IAAI,CAAC,QAAQ,CAAC,MAAM;QAChC,YAAY,IAAI,CAAC,QAAQ,CAAC,UAAU;QACpC,KAAK,IAAI,CAAC,QAAQ,CAAC,OAAO;QAC1B,eAAe,IAAI;IACrB;AACF;AAEO,SAAS,0CACd,OAAgD,EAChD,iBAAyB,EACzB,KAAmB,EACnB,WAAgB,EACR;IACR,MAAM,gBAAgB;QACpB,KAAK,CAAA,GAAA,aAAK,EAAE,GAAG,CAAC,IAAI;QACpB,YAAY,CAAA,GAAA,aAAK,EAAE,GAAG,CAAC,IAAI;QAC3B,KAAK,CAAA,GAAA,aAAK,EAAE,GAAG,CAAC,IAAI;QACpB,YAAY,CAAA,GAAA,aAAK,EAAE,GAAG,CAAC,IAAI;IAC7B;IAEA,MAAM,OAAO,aAAa,CAAC,QAAQ;IAEnC,IAAI,CAAC,MACH,MAAM,IAAI,MACR,mFACA;IAEJ,YAAY;IACZ,KAAK,WAAW,GAAG,kCAAY,IAAI,CAAC;IAEpC,YAAY;IACZ,MAAM,YAAY,KAAK,WAAW;IAElC,MAAM,KAAK,mBAAoB,OAAO,CAAC;IACvC,MAAM,MAAM,0BAA2B,eAAe,CAAC,IAAI;IAE3D,SAAS,oBAAoB,OAAO,EAAE;QACpC,MAAM,MAAM,WAAW,CAAC,QAAQ;QAChC,MAAM,UAAU,cAAe,OAAO,CAAC,KAAK;QAC5C,OAAO;IACT;IAEA,SAAS,QAAQ,aAAa,EAAE,KAAK,EAAE;QACrC,OAAO,MAAM,IAAI,CAAC,CAAC,OAAS;YAC1B,OAAO,KAAK,IAAI,KAAK,iBAAiB,KAAK,WAAW,KAAK;QAC7D;IACF;IAEA,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,CAAC,MAAM,EAAE,IAAK;QACtC,MAAM,QAAQ,GAAG,GAAG,CAAC,EAAE;QAEvB,MAAM,OAAO,iCAAO,IAAI,CAAC,MAAM,IAAI,EAAE,OAAO,OAAO,GAAG,QAAQ,CAAC;QAC/D,MAAM,OAAO,QAAQ,MAAM,MAAM,KAAK;QACtC,IAAI,CAAC,MACH,MAAM,MAAM,mCAAmC,OAAO;QAExD,MAAM,UAAU,KAAK,OAAO;QAC5B,MAAM,UAAU,oBAAoB;QAEpC,MAAM,aAAa;YACjB,mBAAmB;YACnB,KAAK;qBACL;YACA,MAAM;QACR;QACA,IAAI,IAAI,CAAC;IACX;IACA,MAAM,cAAc,IAAI,KAAK,GAAG,KAAK;IACrC,OAAO;AACT;IACA,2CAAe;UACb;AACF","sources":["index.ts"],"sourcesContent":["const bitcoin = require(\"bitcoinjs-lib\");\r\nimport { chains } from \"@hyperbitjs/chains\";\r\n\r\ninterface IUTXO {\r\n  address: string;\r\n  assetName: string;\r\n  txid: string;\r\n  outputIndex: number;\r\n  script: string;\r\n  satoshis: number;\r\n  height: number;\r\n  value: number;\r\n}\r\n\r\nfunction toBitcoinJS() {\r\n  return Object.assign({}, this, {\r\n    bech32: this.bech32,\r\n    bip32: {\r\n      public: (this.versions.bip32 || {}).public,\r\n      private: (this.versions.bip32 || {}).private,\r\n    },\r\n    pubKeyHash: this.versions.public,\r\n    scriptHash: this.versions.scripthash,\r\n    wif: this.versions.private,\r\n    dustThreshold: null, // TODO\r\n  });\r\n}\r\n\r\nexport function sign(\r\n  network: \"rvn\" | \"rvn-test\" | \"evr\" | \"evr-test\",\r\n  rawTransactionHex: string,\r\n  UTXOs: Array<IUTXO>,\r\n  privateKeys: any\r\n): string {\r\n  const networkMapper = {\r\n    rvn: chains.rvn.main,\r\n    \"rvn-test\": chains.rvn.test,\r\n    evr: chains.evr.main,\r\n    \"evr-test\": chains.evr.test,\r\n  };\r\n\r\n  const coin = networkMapper[network];\r\n\r\n  if (!coin) {\r\n    throw new Error(\r\n      \"Validation error, first argument network must be rvn, rvn-test, evr or evr-test\"\r\n    );\r\n  }\r\n  //@ts-ignore\r\n  coin.toBitcoinJS = toBitcoinJS.bind(coin);\r\n\r\n  //@ts-ignore\r\n  const RAVENCOIN = coin.toBitcoinJS();\r\n\r\n  const tx = bitcoin.Transaction.fromHex(rawTransactionHex);\r\n  const txb = bitcoin.TransactionBuilder.fromTransaction(tx, RAVENCOIN);\r\n\r\n  function getKeyPairByAddress(address) {\r\n    const wif = privateKeys[address];\r\n    const keyPair = bitcoin.ECPair.fromWIF(wif, RAVENCOIN);\r\n    return keyPair;\r\n  }\r\n\r\n  function getUTXO(transactionId, index) {\r\n    return UTXOs.find((utxo) => {\r\n      return utxo.txid === transactionId && utxo.outputIndex === index;\r\n    });\r\n  }\r\n\r\n  for (let i = 0; i < tx.ins.length; i++) {\r\n    const input = tx.ins[i];\r\n\r\n    const txId = Buffer.from(input.hash, \"hex\").reverse().toString(\"hex\");\r\n    const utxo = getUTXO(txId, input.index);\r\n    if (!utxo) {\r\n      throw Error(\"Could not find UTXO for input \" + input);\r\n    }\r\n    const address = utxo.address;\r\n    const keyPair = getKeyPairByAddress(address);\r\n\r\n    const signParams = {\r\n      prevOutScriptType: \"p2pkh\",\r\n      vin: i,\r\n      keyPair,\r\n      UTXO: utxo,\r\n    };\r\n    txb.sign(signParams);\r\n  }\r\n  const signedTxHex = txb.build().toHex();\r\n  return signedTxHex;\r\n}\r\nexport default {\r\n  sign,\r\n};\r\n"],"names":[],"version":3,"file":"index.mjs.map"}